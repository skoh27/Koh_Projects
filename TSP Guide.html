<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Your TSP Guide&lt;/title&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Chart.js for charts --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"&gt;&lt;/script&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>/* --- Root Variables &amp; Base Styles --- */</p>
<p class="p1"><span class="Apple-converted-space">        </span>:root {</p>
<p class="p1"><span class="Apple-converted-space">            </span>--navy: #003366;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--olive: #556B2F;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--beige: #F5F5DC;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--dark-beige: #e0e0ca;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--white: #ffffff;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--dark-text: #333333;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--light-text: #f0f0f0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--danger: #990000;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--success: #006400;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--neutral: #5f5f5f;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--highlight: #f0e68c; /* Khaki */</p>
<p class="p1"><span class="Apple-converted-space">            </span>--topic-rates: #d6e2f0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--topic-inflation: #f0e1d6;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--topic-equities: #d6f0dd;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--topic-bonds: #e8d6f0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>--topic-geopolitics: #f0d6d6;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--beige);</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--dark-text);</p>
<p class="p1"><span class="Apple-converted-space">            </span>line-height: 1.6;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 16px; /* Increased base font size */</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* --- Header &amp; Footer --- */</p>
<p class="p1"><span class="Apple-converted-space">        </span>header {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--white);</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1.5rem 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>header h1 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1.6rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>footer {</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.9rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--neutral);</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 2rem 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-top: 1px solid var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 2rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* --- Tabs Navigation --- */</p>
<p class="p1"><span class="Apple-converted-space">        </span>nav.tabs {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-wrap: wrap; /* Allow tabs to wrap on mobile */</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-bottom: 2px solid var(--olive);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.tab-link {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem 1.25rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 0.7;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: all 0.2s ease-in-out;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-grow: 1; /* Allow tabs to share space */</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.tab-link:hover {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: rgba(0, 0, 0, 0.05);</p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 1;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.tab-link.active {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--beige);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-bottom: 3px solid var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 1;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* --- Main Content &amp; Sections --- */</p>
<p class="p1"><span class="Apple-converted-space">        </span>main {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>max-width: 1200px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0 auto;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>@media (min-width: 768px) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>main {</p>
<p class="p1"><span class="Apple-converted-space">                </span>padding: 2rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.tab-content {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>animation: fadeIn 0.5s;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.tab-content.active {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: block;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>@keyframes fadeIn {</p>
<p class="p1"><span class="Apple-converted-space">            </span>from { opacity: 0; }</p>
<p class="p1"><span class="Apple-converted-space">            </span>to { opacity: 1; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>h2, h3, h4 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: "Segoe UI", "Trebuchet MS", sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>h2 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--olive);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-bottom: 2px solid var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding-bottom: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>h3 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 2rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* --- Forms &amp; Inputs --- */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.form-grid, .form-grid-multi {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: grid;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.form-grid {</p>
<p class="p1"><span class="Apple-converted-space">            </span>grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.form-grid-multi {</p>
<p class="p1"><span class="Apple-converted-space">            </span>grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.form-column h4 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.form-group {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-direction: column;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.form-group label,</p>
<p class="p1"><span class="Apple-converted-space">        </span>.checkbox-group label {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--dark-text);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.checkbox-group {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--white);</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.75rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 4px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.checkbox-group input[type="checkbox"] {</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 1.25rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 1.25rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>accent-color: var(--olive);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>input[type="number"],</p>
<p class="p1"><span class="Apple-converted-space">        </span>select {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.75rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #ccc;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 4px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--white);</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-sizing: border-box; /* Ensure padding doesn't break layout */</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* Specifics for optimizer balances */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.balance-input-group {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: grid;</p>
<p class="p1"><span class="Apple-converted-space">            </span>grid-template-columns: 80px 1fr 60px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 0.25rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.balance-input-group label {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.balance-input-group span {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.9rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--neutral);</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: right;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>input[type="range"].allocation-slider {</p>
<p class="p1"><span class="Apple-converted-space">            </span>-webkit-appearance: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 8px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background: #ddd;</p>
<p class="p1"><span class="Apple-converted-space">            </span>outline: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 0.7;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: opacity .2s;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 4px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>input[type="range"].allocation-slider:hover {</p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 1;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>input[type="range"].allocation-slider::-webkit-slider-thumb {</p>
<p class="p1"><span class="Apple-converted-space">            </span>-webkit-appearance: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>appearance: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 20px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 20px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background: var(--olive);</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 50%;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>input[type="range"].allocation-slider::-moz-range-thumb {</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 20px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 20px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background: var(--olive);</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 50%;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.slider-group label {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: normal;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* --- Buttons --- */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.85rem 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1.05rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 4px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--olive);</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--white);</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: background-color 0.2s;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>@media (min-width: 768px) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>.btn {</p>
<p class="p1"><span class="Apple-converted-space">                </span>width: auto;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn:disabled {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--neutral);</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: not-allowed;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn:hover:not(:disabled) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #3f4f23;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-primary {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-primary:hover:not(:disabled) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #002244;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-secondary {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: transparent;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 2px solid var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-secondary:hover:not(:disabled) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: rgba(0, 51, 102, 0.1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.button-group {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-wrap: wrap;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* --- Tooltip --- */</p>
<p class="p1"><span class="Apple-converted-space">        </span>[data-tooltip] {</p>
<p class="p1"><span class="Apple-converted-space">            </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: help;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-decoration: underline dotted;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>[data-tooltip]:hover::after {</p>
<p class="p1"><span class="Apple-converted-space">            </span>content: attr(data-tooltip);</p>
<p class="p1"><span class="Apple-converted-space">            </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">            </span>left: 50%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transform: translateX(-50%);</p>
<p class="p1"><span class="Apple-converted-space">            </span>bottom: 125%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background: var(--dark-text);</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--white);</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.5rem 0.75rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 4px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.9rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: normal;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-decoration: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 280px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>z-index: 10;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: left;</p>
<p class="p1"><span class="Apple-converted-space">            </span>line-height: 1.4;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* --- Results &amp; Containers --- */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.hidden {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: none !important;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.results-container {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 2rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--white);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 8px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>@media (max-width: 768px) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>.results-container {</p>
<p class="p1"><span class="Apple-converted-space">                </span>padding: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.chart-table-split {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-wrap: wrap;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 2rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: flex-start;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.chart-container {</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex: 1;</p>
<p class="p1"><span class="Apple-converted-space">            </span>min-width: 250px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>max-width: 400px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0 auto;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.chart-container-large {</p>
<p class="p1"><span class="Apple-converted-space">            </span>min-width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 350px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.table-container {</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex: 2;</p>
<p class="p1"><span class="Apple-converted-space">            </span>min-width: 300px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>overflow-x: auto; /* Allow horizontal scroll on small tables */</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>table {</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-collapse: collapse;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.95rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>th, td {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.75rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: left;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-bottom: 1px solid var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">            </span>white-space: nowrap;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>td:nth-child(2), td:nth-child(3), td:nth-child(4) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: right;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: monospace;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>th {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f9f9f9;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.explanation-box {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #fdfdfa;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-left: 4px solid var(--olive);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* --- Market Insights Tab (Old &amp; New) --- */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.insight-card {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--white);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 8px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.insight-header {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-wrap: wrap;</p>
<p class="p1"><span class="Apple-converted-space">            </span>justify-content: space-between;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.insight-header h4 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.sentiment {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.25rem 0.75rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.8rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--white);</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-shrink: 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.sentiment.positive { background-color: var(--success); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.sentiment.negative { background-color: var(--danger); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.sentiment.neutral { background-color: var(--neutral); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* --- New Insights Tab Styles --- */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.insights-controls {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-wrap: wrap;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--white);</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 8px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.insights-controls .form-group {</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-grow: 1;</p>
<p class="p1"><span class="Apple-converted-space">            </span>min-width: 150px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.insights-controls label {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.9rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 0.25rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.insights-controls select, .insights-controls .btn-secondary {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.5rem 0.75rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.95rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.filter-chip-group {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-wrap: wrap;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.filter-chip {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.25rem 0.75rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.9rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 500;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--dark-text);</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: all 0.2s ease;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 2px solid transparent;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.filter-chip:hover {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #c7c7a8;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.filter-chip.active {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--white);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>#todays-brief-card ul {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding-left: 20px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>#todays-brief-card li {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 500;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.headline-item {</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-bottom: 1px solid var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.headline-item:last-child {</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-bottom: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding-bottom: 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.headline-item:first-child {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding-top: 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.headline-header {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>justify-content: space-between;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.headline-header h5 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1.05rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--dark-text);</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-grow: 1;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.expand-chevron {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: bold;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: transform 0.2s ease;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-shrink: 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.expand-chevron.expanded {</p>
<p class="p1"><span class="Apple-converted-space">            </span>transform: rotate(90deg);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.headline-meta {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-wrap: wrap;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.topic-chip {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.2rem 0.6rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.8rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #333;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.topic-chip.rates { background-color: var(--topic-rates); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.topic-chip.inflation { background-color: var(--topic-inflation); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.topic-chip.equities { background-color: var(--topic-equities); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.topic-chip.bonds { background-color: var(--topic-bonds); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.topic-chip.geopolitics { background-color: var(--topic-geopolitics); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.headline-explanation {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.95rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 0.75rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.75rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #fdfdfa;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-left: 3px solid var(--olive);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>#tsp-implications-card h5 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1.1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0.5rem 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.tilt-chip-group {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-wrap: wrap;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 0.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.tilt-chip {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.3rem 0.8rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 4px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.9rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 0.25rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.tilt-chip-label {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.tilt-chip.headwind { background-color: #fceded; color: var(--danger); border: 1px solid var(--danger); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.tilt-chip.tailwind { background-color: #eaf7ea; color: var(--success); border: 1px solid var(--success); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.tilt-chip.neutral { background-color: #f0f0f0; color: var(--neutral); border: 1px solid #ccc; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.tilt-chip.stable { background-color: #f0f0f0; color: var(--neutral); border: 1px solid #ccc; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.tilt-chip.pressure { background-color: #fff8e1; color: #b8860b; border: 1px solid #e6dbb9; }</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* --- Resilience Tab Specifics --- */</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* Segmented Control for Mode Toggle */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.segmented-control {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 2px solid var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 8px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>overflow: hidden;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.segmented-control input[type="radio"] {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: none;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.segmented-control label {</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex: 1;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0.75rem 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--white);</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: all 0.2s ease-in-out;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-left: 1px solid var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.segmented-control label:first-of-type {</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-left: none;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.segmented-control input[type="radio"]:checked + label {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--white);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.summary-box {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1.15rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 500;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid var(--olive);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 8px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 2rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.simulation-count {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 0.9rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--neutral);</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 1.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.results-table td:last-child {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: right;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Segoe UI', sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 1.05rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.warning-box {</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: var(--danger);</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #fff0f0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid var(--danger);</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 4px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* Loader Spinner */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.loader {</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 5px solid var(--dark-beige);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-top: 5px solid var(--navy);</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 50%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 40px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 40px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>animation: spin 1s linear infinite;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 2rem auto;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.loader-inline {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: inline-block;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 20px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 20px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-width: 3px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>vertical-align: middle;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-left: 10px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>@keyframes spin {</p>
<p class="p1"><span class="Apple-converted-space">            </span>0% { transform: rotate(0deg); }</p>
<p class="p1"><span class="Apple-converted-space">            </span>100% { transform: rotate(360deg); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;header&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h1&gt;Your TSP Guide: Financial Readiness for Service Members&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;nav class="tabs"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="tab-link active" data-tab="optimizer"&gt;Portfolio Optimizer&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="tab-link" data-tab="insights"&gt;Market Insights&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="tab-link" data-tab="resilience"&gt;Retirement Withdrawal Resilience&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/nav&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;main&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- ====================================================== --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- TAB 1: PORTFOLIO OPTIMIZER <span class="Apple-converted-space">                            </span>--&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- ====================================================== --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;section id="optimizer" class="tab-content active"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2&gt;1. Portfolio Optimizer&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p&gt;Get a sample TSP allocation based on your risk tolerance and time horizon.&lt;/p&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="form-grid"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="risk-tolerance"&gt;Risk Tolerance&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;select id="risk-tolerance"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;option value="Low"&gt;Low (Conservative)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;option value="Moderate"&gt;Moderate (Balanced)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;option value="High"&gt;High (Aggressive)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="investment-horizon"&gt;Investment Horizon (Years)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="investment-horizon" value="20" min="1" max="50"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="checkbox-group" style="margin-top: 1.5rem;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;input type="checkbox" id="include-balances-checkbox"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="include-balances-checkbox"&gt;I want to include my current TSP balances (optional)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="current-balances-section" class="results-container hidden" style="margin-top: 1rem; background-color: #fdfdfa;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h4&gt;Current Balances ($)&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="balance-input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="current-g"&gt;G Fund&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="current-g" class="current-balance-input" value="0" min="0" step="1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span id="current-g-pct"&gt;0%&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="balance-input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="current-f"&gt;F Fund&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="current-f" class="current-balance-input" value="0" min="0" step="1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span id="current-f-pct"&gt;0%&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="balance-input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="current-c"&gt;C Fund&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="current-c" class="current-balance-input" value="0" min="0" step="1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span id="current-c-pct"&gt;0%&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="balance-input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="current-s"&gt;S Fund&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="current-s" class="current-balance-input" value="0" min="0" step="1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span id="current-s-pct"&gt;0%&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="balance-input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="current-i"&gt;I Fund&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="current-i" class="current-balance-input" value="0" min="0" step="1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span id="current-i-pct"&gt;0%&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;hr&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="balance-input-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label&gt;Total&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="text" id="current-total" style="border:none; background:transparent; font-weight: bold;" value="$0.00" readonly&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span&gt;100%&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="button-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="calculate-optimizer" class="btn"&gt;Calculate Allocation&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="copy-to-resilience-btn" class="btn btn-secondary hidden"&gt;Copy to Withdrawal Resilience&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="optimizer-results" class="results-container hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="target-allocation-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3&gt;Recommended Target Allocation&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="chart-table-split"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="chart-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;canvas id="optimizer-pie-chart"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="table-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;table id="allocation-table"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;th&gt;Fund&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;th&gt;Allocation&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>&lt;th&gt;Description&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;!-- Rows will be inserted by JS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="rebalance-plan-container" class="hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h3&gt;Rebalance Plan&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="table-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;table id="rebalance-table"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;th&gt;Fund&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;th&gt;Current ($)&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;th&gt;Target ($)&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;th&gt;Rebalance ($)&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;!-- Rows will be inserted by JS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="explanation-box" id="allocation-explanation"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Explanation will be inserted by JS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- ====================================================== --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- TAB 2: MARKET INSIGHTS <span class="Apple-converted-space">                                </span>--&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- ====================================================== --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;section id="insights" class="tab-content"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2&gt;2. Market Insights (Simulated)&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p&gt;Understand how market news can (or shouldn't) affect your long-term plan.&lt;/p&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- Controls --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="insights-controls"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="form-group" style="min-width: 200px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="sentiment-filter"&gt;Filter by Sentiment&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;select id="sentiment-filter"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;option value="All"&gt;All Sentiments&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;option value="Positive"&gt;Positive&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;option value="Neutral"&gt;Neutral&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;option value="Negative"&gt;Negative&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="form-group" style="flex-grow: 2;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label&gt;Filter by Topic&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="filter-chip-group" id="topic-filter-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;!-- Topic filter chips will be injected by JS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label for="reading-mode"&gt;Reading Mode&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;select id="reading-mode"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;option value="Brief"&gt;Brief (Click to expand)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;option value="Detailed"&gt;Detailed (Show all)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;label&gt;&amp;nbsp;&lt;/label&gt; &lt;!-- Spacer for alignment --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button id="export-brief-btn" class="btn btn-secondary"&gt;Export Brief (.txt)&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- Card 1: Today's Brief --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="todays-brief-card" class="insight-card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3&gt;Today's Brief&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;ul id="brief-list"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Brief points will be injected by JS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/ul&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- Card 3: TSP Implications (Placed before feed for mobile) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="tsp-implications-card" class="insight-card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3 style="margin-top: 0;"&gt;What this could mean for TSP funds&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p id="implications-summary"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Summary paragraph will be injected by JS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h5&gt;Suggested Tilts Based on Feed:&lt;/h5&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="tilt-chip-group" id="implications-chip-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Tilt chips will be injected by JS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- Card 2: Headline Feed --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="headline-feed-card" class="insight-card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3 style="margin-top: 0;"&gt;Headline Feed&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="headline-list-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Headlines will be injected by JS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- ====================================================== --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- TAB 3: RETIREMENT WITHDRAWAL RESILIENCE <span class="Apple-converted-space">                </span>--&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- ====================================================== --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;section id="resilience" class="tab-content"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2&gt;3. Retirement Withdrawal Resilience&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p&gt;Stress-test your retirement plan using a 10,000-path Monte Carlo simulation.&lt;/p&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;!-- Mode Toggle --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="segmented-control"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;input type="radio" id="mode-a" name="resilience-mode" value="A" checked&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="mode-a" data-tooltip="Calculates how much you can safely withdraw from a known portfolio value."&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>Compute Sustainable Withdrawal</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/label&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;input type="radio" id="mode-b" name="resilience-mode" value="B"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="mode-b" data-tooltip="Calculates how much you need to start with to support a desired withdrawal amount."&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>Compute Required Retirement Amount</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="form-grid-multi"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Column 1: Core Inputs --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="form-column"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h4&gt;Core Scenario&lt;/h4&gt;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Mode A Input --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="mode-a-inputs" class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="portfolio-value"&gt;Portfolio Value ($)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="portfolio-value" value="500000" step="1000"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Mode B Input --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="mode-b-inputs" class="form-group hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="desired-monthly-withdrawal"&gt;Desired Monthly Withdrawal ($)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="desired-monthly-withdrawal" value="2000" step="100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="retirement-horizon"&gt;Retirement Horizon (Years)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="retirement-horizon" value="30" min="5" max="50"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="inflation-rate"&gt;Baseline Inflation (%)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="inflation-rate" value="2.5" step="0.1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="success-probability"&gt;Target Success Probability (%)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="success-probability" value="90" min="50" max="100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="num-simulations"&gt;Simulations&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="number" id="num-simulations" value="10000" min="1000" max="50000" step="1000" readonly&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Column 2: Allocations --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="form-column"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h4&gt;Fund Allocations (&lt;span id="total-allocation"&gt;100&lt;/span&gt;%)&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-group slider-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="g-fund-slider"&gt;G Fund: &lt;span id="g-fund-value"&gt;20&lt;/span&gt;%&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="range" id="g-fund-slider" class="allocation-slider" min="0" max="100" value="20" step="1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-group slider-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="f-fund-slider"&gt;F Fund: &lt;span id="f-fund-value"&gt;20&lt;/span&gt;%&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="range" id="f-fund-slider" class="allocation-slider" min="0" max="100" value="20" step="1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-group slider-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="c-fund-slider"&gt;C Fund: &lt;span id="c-fund-value"&gt;30&lt;/span&gt;%&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="range" id="c-fund-slider" class="allocation-slider" min="0" max="100" value="30" step="1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-group slider-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="s-fund-slider"&gt;S Fund: &lt;span id="s-fund-value"&gt;20&lt;/span&gt;%&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="range" id="s-fund-slider" class="allocation-slider" min="0" max="100" value="20" step="1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-group slider-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="i-fund-slider"&gt;I Fund: &lt;span id="i-fund-value"&gt;10&lt;/span&gt;%&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="range" id="i-fund-slider" class="allocation-slider" min="0" max="100" value="10" step="1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Column 3: Stress Tests --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="form-column"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;h4&gt;Year 1 Stress Test (Optional)&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="equity-drop"&gt;Equity Market Drop (C/S/I)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;select id="equity-drop"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="0"&gt;0% (No Shock)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="-0.10"&gt;-10%&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="-0.15"&gt;-15%&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="-0.25"&gt;-25%&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="rate-rise"&gt;Interest Rate Rise (G/F)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;select id="rate-rise"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="0"&gt;0% (No Shock)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="0.01"&gt;+1%&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="0.02"&gt;+2%&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="inflation-shock"&gt;Inflation Shock&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;select id="inflation-shock"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="0"&gt;0% (No Shock)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="0.01"&gt;+1%&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;option value="0.02"&gt;+2%&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="allocation-warning" class="warning-box hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>Allocation must sum to 100% to run the simulation.</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="button-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="run-simulation" class="btn btn-primary"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span id="run-simulation-text"&gt;Run Simulation&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="simulation-loader" class="loader loader-inline hidden"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="download-summary-btn" class="btn btn-secondary hidden"&gt;Download Summary (.json)&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="resilience-results" class="results-container hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h3&gt;Simulation Results&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="summary-box" id="resilience-summary"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;!-- Summary will be inserted by JS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="form-grid-multi"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-column"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h4&gt;Key Metrics&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;table class="results-table"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;!-- Mode A Results --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;tr id="mode-a-result-annual" class="mode-a-result"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td&gt;Sustainable Annual Withdrawal&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td id="annual-withdrawal-result"&gt;&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;tr id="mode-a-result-monthly" class="mode-a-result"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td&gt;Sustainable Monthly Withdrawal&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td id="monthly-withdrawal-result"&gt;&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/tr&gt;</p>
<p class="p2"><span class="Apple-converted-space">                            </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;!-- Mode B Results --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;tr id="mode-b-result-portfolio" class="mode-b-result hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td&gt;Required Starting Portfolio&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td id="required-portfolio-result"&gt;&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/tr&gt;</p>
<p class="p2"><span class="Apple-converted-space">                            </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;!-- Shared Results --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td&gt;Achieved Success Probability&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td id="success-prob-result"&gt;&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td&gt;Depletion Year (10th Percentile)&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;td id="depletion-year-result"&gt;&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="simulation-count" id="simulation-count-display"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="form-column"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h4&gt;Simulated Portfolio Balance (Nominal)&lt;/h4&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="chart-container-large"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;canvas id="resilience-line-chart"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/section&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/main&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;footer&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;This tool is for educational purposes only and does not provide financial advice. Consult with a qualified financial advisor before making any decisions. Simulated returns are not guarantees of future performance. Headlines are illustrative and for educational use only—no financial advice is provided or implied.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/footer&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.addEventListener('DOMContentLoaded', () =&gt; {</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Global Variables ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>let optimizerChart = null;</p>
<p class="p1"><span class="Apple-converted-space">            </span>let resilienceChart = null;</p>
<p class="p1"><span class="Apple-converted-space">            </span>let lastTargetAllocation = null; // Store optimizer results</p>
<p class="p1"><span class="Apple-converted-space">            </span>let lastSimulationParams = null; // Store simulation inputs</p>
<p class="p1"><span class="Apple-converted-space">            </span>let lastSimulationResults = null; // Store simulation outputs</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const fundTooltips = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>G: "G Fund (Gov't Securities): Pays interest. Protected from loss. Invests in short-term U.S. Treasury securities.",</p>
<p class="p1"><span class="Apple-converted-space">                </span>F: "F Fund (Fixed Income): Pays interest. Risk of loss. Invests in U.S. government, corporate, and mortgage-backed bonds.",</p>
<p class="p1"><span class="Apple-converted-space">                </span>C: "C Fund (Common Stock): High risk. Invests in the S&amp;P 500 index, tracking 500 large U.S. companies.",</p>
<p class="p1"><span class="Apple-converted-space">                </span>S: "S Fund (Small Cap): Very high risk. Invests in small-to-mid-sized U.S. companies not in the S&amp;P 500.",</p>
<p class="p1"><span class="Apple-converted-space">                </span>I: "I Fund (International): High risk. Invests in large companies across 20+ developed countries outside the U.S."</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Helper Functions ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>const $ = (id) =&gt; document.getElementById(id);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const formatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });</p>
<p class="p1"><span class="Apple-converted-space">            </span>const intFormatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Tab Switching Logic ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>const tabLinks = document.querySelectorAll('.tab-link');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const tabContents = document.querySelectorAll('.tab-content');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>tabLinks.forEach(link =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>link.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const tabId = link.getAttribute('data-tab');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>tabLinks.forEach(item =&gt; item.classList.remove('active'));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>tabContents.forEach(item =&gt; item.classList.remove('active'));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>link.classList.add('active');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>$(tabId).classList.add('active');</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// ======================================================</p>
<p class="p1"><span class="Apple-converted-space">            </span>// TAB 1: PORTFOLIO OPTIMIZER</p>
<p class="p1"><span class="Apple-converted-space">            </span>// ======================================================</p>
<p class="p1"><span class="Apple-converted-space">            </span>const calculateOptimizerBtn = $('calculate-optimizer');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const includeBalancesCheckbox = $('include-balances-checkbox');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const currentBalancesSection = $('current-balances-section');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const currentBalanceInputs = document.querySelectorAll('.current-balance-input');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const rebalancePlanContainer = $('rebalance-plan-container');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const optimizerResults = $('optimizer-results');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const copyToResilienceBtn = $('copy-to-resilience-btn');</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (calculateOptimizerBtn) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>calculateOptimizerBtn.addEventListener('click', runPortfolioOptimizer);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>includeBalancesCheckbox.addEventListener('change', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentBalancesSection.classList.toggle('hidden', !includeBalancesCheckbox.checked);</p>
<p class="p1"><span class="Apple-converted-space">                </span>// Hide rebalance plan if unchecked, it will be reshown on calculate</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!includeBalancesCheckbox.checked) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>rebalancePlanContainer.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>currentBalanceInputs.forEach(input =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>input.addEventListener('input', updateCurrentAllocations);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>function updateCurrentAllocations() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>let totalBalance = 0;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const balances = {};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>currentBalanceInputs.forEach(input =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const fund = input.id.split('-')[1];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const value = parseFloat(input.value) || 0;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (value &lt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>input.value = 0;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>value = 0;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>balances[fund] = value;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>totalBalance += value;</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>$('current-total').value = formatter.format(totalBalance);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>['g', 'f', 'c', 's', 'i'].forEach(fund =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const pct = totalBalance &gt; 0 ? (balances[fund] / totalBalance) * 100 : 0;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>$(`current-${fund}-pct`).textContent = `${pct.toFixed(0)}%`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>copyToResilienceBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (lastTargetAllocation) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>updateResilienceSliders(lastTargetAllocation);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Switch to resilience tab</p>
<p class="p1"><span class="Apple-converted-space">                    </span>tabLinks.forEach(link =&gt; link.classList.remove('active'));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>tabContents.forEach(item =&gt; item.classList.remove('active'));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.querySelector('[data-tab="resilience"]').classList.add('active');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>$('resilience').classList.add('active');</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>function runPortfolioOptimizer() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const risk = $('risk-tolerance').value;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const horizon = parseInt($('investment-horizon').value);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const allocation = getAllocation(risk, horizon);</p>
<p class="p1"><span class="Apple-converted-space">                </span>lastTargetAllocation = allocation; // Save for copy button</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const explanation = getExplanation(risk, horizon, allocation);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>displayAllocationTable(allocation);</p>
<p class="p1"><span class="Apple-converted-space">                </span>displayAllocationPieChart(allocation);</p>
<p class="p1"><span class="Apple-converted-space">                </span>$('allocation-explanation').innerHTML = `&lt;p&gt;&lt;strong&gt;Why this allocation?&lt;/strong&gt; ${explanation}&lt;/p&gt;`;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Handle rebalancing</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (includeBalancesCheckbox.checked) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>let totalBalance = 0;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const currentBalances = {};</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentBalanceInputs.forEach(input =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const fund = input.id.split('-')[1].toUpperCase();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const value = parseFloat(input.value) || 0;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>currentBalances[fund] = value;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>totalBalance += value;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (totalBalance &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>displayRebalanceTable(currentBalances, totalBalance, allocation);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>rebalancePlanContainer.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>rebalancePlanContainer.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                     </span>rebalancePlanContainer.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>optimizerResults.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>copyToResilienceBtn.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>function getAllocation(risk, horizon) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// Simplified allocation logic</p>
<p class="p1"><span class="Apple-converted-space">                </span>let alloc = { G: 0, F: 0, C: 0, S: 0, I: 0 };</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (risk === 'Low') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (horizon &lt; 5) <span class="Apple-converted-space">        </span>{ alloc = { G: 60, F: 40, C: 0,<span class="Apple-converted-space">  </span>S: 0,<span class="Apple-converted-space">  </span>I: 0<span class="Apple-converted-space">  </span>}; }</p>
<p class="p1"><span class="Apple-converted-space">                    </span>else if (horizon &lt; 15) <span class="Apple-converted-space">  </span>{ alloc = { G: 40, F: 30, C: 20, S: 5,<span class="Apple-converted-space">  </span>I: 5<span class="Apple-converted-space">  </span>}; }</p>
<p class="p1"><span class="Apple-converted-space">                    </span>else <span class="Apple-converted-space">                    </span>{ alloc = { G: 30, F: 30, C: 25, S: 10, I: 5<span class="Apple-converted-space">  </span>}; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else if (risk === 'Moderate') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (horizon &lt; 5) <span class="Apple-converted-space">        </span>{ alloc = { G: 30, F: 30, C: 25, S: 10, I: 5<span class="Apple-converted-space">  </span>}; }</p>
<p class="p1"><span class="Apple-converted-space">                    </span>else if (horizon &lt; 15) <span class="Apple-converted-space">  </span>{ alloc = { G: 10, F: 20, C: 40, S: 15, I: 15 }; }</p>
<p class="p1"><span class="Apple-converted-space">                    </span>else <span class="Apple-converted-space">                    </span>{ alloc = { G: 5,<span class="Apple-converted-space">  </span>F: 15, C: 45, S: 20, I: 15 }; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else if (risk === 'High') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (horizon &lt; 5) <span class="Apple-converted-space">        </span>{ alloc = { G: 10, F: 10, C: 50, S: 20, I: 10 }; }</p>
<p class="p1"><span class="Apple-converted-space">                    </span>else if (horizon &lt; 15) <span class="Apple-converted-space">  </span>{ alloc = { G: 0,<span class="Apple-converted-space">  </span>F: 5,<span class="Apple-converted-space">  </span>C: 50, S: 25, I: 20 }; }</p>
<p class="p1"><span class="Apple-converted-space">                    </span>else <span class="Apple-converted-space">                    </span>{ alloc = { G: 0,<span class="Apple-converted-space">  </span>F: 5,<span class="Apple-converted-space">  </span>C: 45, S: 30, I: 20 }; }</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>return alloc;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>function getExplanation(risk, horizon, alloc) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (risk === 'Low') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return `With a ${risk.toLowerCase()} risk tolerance, your priority is capital preservation. This portfolio is heavily weighted towards the &lt;strong&gt;G and F Funds&lt;/strong&gt; to protect your principal and provide stable returns, especially given your ${horizon}-year horizon.`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (risk === 'Moderate' &amp;&amp; horizon &gt; 10) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return `This &lt;strong&gt;balanced&lt;/strong&gt; approach provides significant growth potential from the stock funds (&lt;strong&gt;C, S, I Funds&lt;/strong&gt;) while using bonds (&lt;strong&gt;G and F Funds&lt;/strong&gt;) to reduce volatility. Since you have over a decade, you can weather market downturns for higher long-term returns.`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (risk === 'High' &amp;&amp; horizon &gt; 15) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return `With an aggressive tolerance and a long time horizon (${horizon} years), you are positioned to maximize growth. This allocation is almost entirely in stocks (&lt;strong&gt;C, S, and I Funds&lt;/strong&gt;) which, while volatile, have historically provided the highest returns over long periods.`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>// Default</p>
<p class="p1"><span class="Apple-converted-space">                </span>return `This allocation balances your ${risk.toLowerCase()} risk tolerance with your ${horizon}-year time horizon. The stock funds (C, S, I) are for growth, while the bond funds (G, F) provide stability.`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>function displayAllocationTable(allocation) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const tableBody = $('allocation-table').tBodies[0];</p>
<p class="p1"><span class="Apple-converted-space">                </span>tableBody.innerHTML = ''; // Clear old data</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>['G', 'F', 'C', 'S', 'I'].forEach(fund =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const row = tableBody.insertRow();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>row.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;td&gt;&lt;span data-tooltip="${fundTooltips[fund]}"&gt;${fund} Fund&lt;/span&gt;&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;td style="text-align: right; font-family: monospace; font-size: 1rem;"&gt;${allocation[fund]}%&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;td&gt;${fundTooltips[fund].split(':')[1].split('.')[0].trim()}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>function displayRebalanceTable(current, total, target) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const tableBody = $('rebalance-table').tBodies[0];</p>
<p class="p1"><span class="Apple-converted-space">                </span>tableBody.innerHTML = ''; // Clear old data</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>['G', 'F', 'C', 'S', 'I'].forEach(fund =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const targetDollar = (target[fund] / 100) * total;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const delta = targetDollar - current[fund];</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>const row = tableBody.insertRow();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>row.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;td&gt;&lt;span data-tooltip="${fundTooltips[fund]}"&gt;${fund} Fund&lt;/span&gt;&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;td&gt;${formatter.format(current[fund])}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;td&gt;${formatter.format(targetDollar)}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;td style="color: ${delta &gt;= 0 ? 'var(--success)' : 'var(--danger)'}"&gt;${delta &gt;= 0 ? '+' : ''}${formatter.format(delta)}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>function displayAllocationPieChart(allocation) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const ctx = $('optimizer-pie-chart').getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const labels = ['G Fund', 'F Fund', 'C Fund', 'S Fund', 'I Fund'];</p>
<p class="p1"><span class="Apple-converted-space">                </span>const data = [allocation.G, allocation.F, allocation.C, allocation.S, allocation.I];</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (optimizerChart) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>optimizerChart.destroy();</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>optimizerChart = new Chart(ctx, {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>type: 'pie',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>data: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>labels: labels,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>datasets: [{</p>
<p class="p1"><span class="Apple-converted-space">                            </span>data: data,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>backgroundColor: ['#556B2F', '#BDB76B', '#003366', '#4682B4', '#87CEEB']</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}]</p>
<p class="p1"><span class="Apple-converted-space">                    </span>},</p>
<p class="p1"><span class="Apple-converted-space">                    </span>options: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>responsive: true,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>plugins: {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>legend: {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>position: 'top',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>},</p>
<p class="p1"><span class="Apple-converted-space">                            </span>tooltip: {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>callbacks: {</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>label: function(context) {</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>return `${context.label}: ${context.raw}%`;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// ======================================================</p>
<p class="p1"><span class="Apple-converted-space">            </span>// TAB 2: MARKET INSIGHTS (NEW LOGIC)</p>
<p class="p1"><span class="Apple-converted-space">            </span>// ======================================================</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Simulated Data ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>const simulatedHeadlines = [</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 1, text: "Fed signals 'higher for longer' rate hikes to combat inflation.", sentiment: "Negative", topic: "Rates", keywords: ["rate hike", "inflation"], explanation: "The central bank plans to keep interest rates high, which can slow down the economy and make bonds less valuable." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 2, text: "Strong jobs report shows economic resilience, but fuels inflation fears.", sentiment: "Neutral", topic: "Inflation", keywords: ["inflation", "job losses"], explanation: "A strong economy is good, but it may lead to persistent inflation, forcing the Fed to keep rates high." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 3, text: "Tech sector leads market rally as S&amp;P 500 hits new highs.", sentiment: "Positive", topic: "Equities", keywords: ["stocks rally", "SPX up"], explanation: "Large-cap stocks (like in the C Fund) are performing well, driving market optimism." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 4, text: "Geopolitical tensions in Asia disrupt supply chains, raising cost concerns.", sentiment: "Negative", topic: "Geopolitics", keywords: ["inflation up"], explanation: "Global instability can lead to higher prices for goods, which fuels inflation and hurts market stability." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 5, text: "Treasury yields rise to 3-month high on hawkish Fed comments.", sentiment: "Negative", topic: "Bonds", keywords: ["yields rise", "rate hike"], explanation: "When bond yields rise, the price of existing bonds (like those in the F Fund) typically falls." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 6, text: "CPI report comes in cooler than expected; inflation may be easing.", sentiment: "Positive", topic: "Inflation", keywords: ["inflation"], explanation: "Signs of lower inflation are positive for the market, as it may allow the central bank to lower interest rates." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 7, text: "Small-cap stocks lag behind large-caps amid slowdown fears.", sentiment: "Neutral", topic: "Equities", keywords: ["slowdown", "risk-on"], explanation: "Investors are hesitant to buy smaller company stocks (like in the S Fund) when the economy might be slowing." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 8, text: "Manufacturing data shows surprise contraction, sparking recession risk chatter.", sentiment: "Negative", topic: "Equities", keywords: ["recession risk", "slowdown"], explanation: "A shrinking manufacturing sector is a classic sign of an economic slowdown, which is typically bad for stocks." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 9, text: "European markets show surprising strength, I Fund gets a boost.", sentiment: "Positive", topic: "Equities", keywords: ["stocks rally"], explanation: "International stocks (like in the I Fund) are performing well, adding diversification to U.S. holdings." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>{ id: 10, text: "Analysts predict sticky inflation to persist through next year.", sentiment: "Negative", topic: "Inflation", keywords: ["sticky inflation", "inflation up"], explanation: "If inflation stays high, it will continue to erode the purchasing power of savings and put pressure on bond funds." }</p>
<p class="p1"><span class="Apple-converted-space">            </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const allTopics = [...new Set(simulatedHeadlines.map(h =&gt; h.topic))];</p>
<p class="p1"><span class="Apple-converted-space">            </span>let selectedTopics = [...allTopics]; // Start with all topics selected</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Rules Engine Data ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>const keywordRules = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// Negative/Defensive</p>
<p class="p1"><span class="Apple-converted-space">                </span>"rate hike": { G: "stable", F: "headwind", C: "pressure", S: "pressure", I: "pressure" },</p>
<p class="p1"><span class="Apple-converted-space">                </span>"yields rise": { G: "stable", F: "headwind", C: "pressure", S: "pressure", I: "pressure" },</p>
<p class="p1"><span class="Apple-converted-space">                </span>"inflation up": { G: "neutral", F: "headwind", C: "pressure", S: "pressure", I: "pressure", Note: "Real returns face pressure." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>"sticky inflation": { G: "neutral", F: "headwind", C: "pressure", S: "pressure", I: "pressure", Note: "Real returns face pressure." },</p>
<p class="p1"><span class="Apple-converted-space">                </span>"recession risk": { G: "tailwind", F: "tailwind", C: "headwind", S: "headwind", I: "headwind" },</p>
<p class="p1"><span class="Apple-converted-space">                </span>"slowdown": { G: "tailwind", F: "tailwind", C: "headwind", S: "headwind", I: "headwind" },</p>
<p class="p1"><span class="Apple-converted-space">                </span>"job losses": { G: "tailwind", F: "tailwind", C: "headwind", S: "headwind", I: "headwind" },</p>
<p class="p1"><span class="Apple-converted-space">                </span>// Positive/Growth</p>
<p class="p1"><span class="Apple-converted-space">                </span>"stocks rally": { G: "neutral", F: "neutral", C: "tailwind", S: "tailwind", I: "tailwind" },</p>
<p class="p1"><span class="Apple-converted-space">                </span>"risk-on": { G: "neutral", F: "neutral", C: "tailwind", S: "tailwind", I: "tailwind" },</p>
<p class="p1"><span class="Apple-converted-space">                </span>"SPX up": { G: "neutral", F: "neutral", C: "tailwind", S: "tailwind", I: "tailwind" }</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Insights Tab Elements ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>const sentimentFilter = $("sentiment-filter");</p>
<p class="p1"><span class="Apple-converted-space">            </span>const topicFilterGroup = $("topic-filter-group");</p>
<p class="p1"><span class="Apple-converted-space">            </span>const readingMode = $("reading-mode");</p>
<p class="p1"><span class="Apple-converted-space">            </span>const exportBriefBtn = $("export-brief-btn");</p>
<p class="p1"><span class="Apple-converted-space">            </span>const briefList = $("brief-list");</p>
<p class="p1"><span class="Apple-converted-space">            </span>const implicationsSummary = $("implications-summary");</p>
<p class="p1"><span class="Apple-converted-space">            </span>const implicationsChipGroup = $("implications-chip-group");</p>
<p class="p1"><span class="Apple-converted-space">            </span>const headlineListContainer = $("headline-list-container");</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Insights Initialization ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>function initializeInsightsTab() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// 1. Setup Topic Filters</p>
<p class="p1"><span class="Apple-converted-space">                </span>topicFilterGroup.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>allTopics.forEach(topic =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const chip = document.createElement('span');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>chip.className = 'filter-chip active';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>chip.dataset.topic = topic;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>chip.textContent = topic;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>chip.addEventListener('click', toggleTopicFilter);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>topicFilterGroup.appendChild(chip);</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 2. Add Listeners</p>
<p class="p1"><span class="Apple-converted-space">                </span>sentimentFilter.addEventListener('change', updateInsightsView);</p>
<p class="p1"><span class="Apple-converted-space">                </span>readingMode.addEventListener('change', updateInsightsView);</p>
<p class="p1"><span class="Apple-converted-space">                </span>exportBriefBtn.addEventListener('click', exportBrief);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 3. Initial Render</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateInsightsView();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>function toggleTopicFilter(event) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const chip = event.target;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const topic = chip.dataset.topic;</p>
<p class="p1"><span class="Apple-converted-space">                </span>chip.classList.toggle('active');</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (chip.classList.contains('active')) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>selectedTopics.push(topic);</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>selectedTopics = selectedTopics.filter(t =&gt; t !== topic);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateInsightsView();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Main Update Function for Insights ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>function updateInsightsView() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const sentiment = sentimentFilter.value;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const mode = readingMode.value;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 1. Filter Headlines</p>
<p class="p1"><span class="Apple-converted-space">                </span>const filteredHeadlines = simulatedHeadlines.filter(h =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const sentimentMatch = (sentiment === 'All' || h.sentiment === sentiment);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const topicMatch = selectedTopics.includes(h.topic);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return sentimentMatch &amp;&amp; topicMatch;</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 2. Analyze Filtered Headlines</p>
<p class="p1"><span class="Apple-converted-space">                </span>const analysis = analyzeHeadlines(filteredHeadlines);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 3. Render Brief &amp; Implications</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderBriefAndImplications(analysis);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 4. Render Headline Feed</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderHeadlineFeed(filteredHeadlines, mode);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>function analyzeHeadlines(filteredHeadlines) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const analysis = {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>brief: [],</p>
<p class="p1"><span class="Apple-converted-space">                    </span>implications: { G: "neutral", F: "neutral", C: "neutral", S: "neutral", I: "neutral" },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>summary: "",</p>
<p class="p1"><span class="Apple-converted-space">                    </span>notes: new Set()</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>let sentimentScore = 0;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const keywordCounts = {};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Aggregate sentiments and keywords</p>
<p class="p1"><span class="Apple-converted-space">                </span>filteredHeadlines.forEach(h =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (h.sentiment === 'Positive') sentimentScore++;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (h.sentiment === 'Negative') sentimentScore--;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>h.keywords.forEach(kw =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>keywordCounts[kw] = (keywordCounts[kw] || 0) + 1;</p>
<p class="p2"><span class="Apple-converted-space">                        </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>// Apply rules</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (keywordRules[kw]) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const rule = keywordRules[kw];</p>
<p class="p1"><span class="Apple-converted-space">                            </span>Object.keys(rule).forEach(key =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>if (key === 'Note') {</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>analysis.notes.add(rule.Note);</p>
<p class="p1"><span class="Apple-converted-space">                                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>// Simple priority: headwind/tailwind overrides pressure/neutral</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>const current = analysis.implications[key];</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>const next = rule[key];</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>if (next === 'headwind' || next === 'tailwind') {</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>analysis.implications[key] = next;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>} else if (next === 'pressure' &amp;&amp; current !== 'headwind' &amp;&amp; current !== 'tailwind') {</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>analysis.implications[key] = next;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>} else if (next === 'stable' &amp;&amp; current === 'neutral') {</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>analysis.implications[key] = next;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                            </span>});</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// --- Generate Brief ---</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (keywordCounts["rate hike"] || keywordCounts["yields rise"]) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>analysis.brief.push("Interest rates are trending higher on hawkish central bank commentary.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>analysis.brief.push("Interest rates remain stable, awaiting new economic data.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (keywordCounts["inflation up"] || keywordCounts["sticky inflation"]) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>analysis.brief.push("Inflation fears are elevated, with data showing persistent price pressures.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>analysis.brief.push("Inflation appears to be easing, boosting market confidence.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (keywordCounts["recession risk"] || keywordCounts["slowdown"]) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>analysis.brief.push("Economic slowdown fears are growing, leading to defensive posturing.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else if (sentimentScore &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>analysis.brief.push("Market sentiment is positive, with equities leading gains.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>analysis.brief.push("Equity markets are mixed as investors weigh competing economic signals.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// --- Generate Summary ---</p>
<p class="p1"><span class="Apple-converted-space">                </span>let summaryParts = [];</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (analysis.implications.F === 'headwind' || analysis.implications.C === 'pressure') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>summaryParts.push("Rising rates and inflation concerns are creating headwinds for bond funds (F Fund) and putting pressure on stock funds (C, S, I).");</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (analysis.implications.G === 'tailwind' || analysis.implications.G === 'stable') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>summaryParts.push("The G Fund remains a stable option for capital preservation.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (analysis.implications.C === 'tailwind') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>summaryParts.push("Positive market sentiment is providing a tailwind for stock funds (C, S, I).");</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (analysis.implications.C === 'headwind') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>summaryParts.push("Recession fears suggest a defensive tilt, favoring G and F funds over C, S, and I funds.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (summaryParts.length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>summaryParts.push("The market is showing mixed signals, suggesting a balanced approach remains prudent.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (analysis.notes.size &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>summaryParts.push([...analysis.notes].join(' '));</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>analysis.summary = summaryParts.join(' ');</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>return analysis;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>function renderBriefAndImplications(analysis) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// 1. Render Brief</p>
<p class="p1"><span class="Apple-converted-space">                </span>briefList.innerHTML = analysis.brief.map(item =&gt; `&lt;li&gt;${item}&lt;/li&gt;`).join('');</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 2. Render Implications Summary</p>
<p class="p1"><span class="Apple-converted-space">                </span>implicationsSummary.textContent = analysis.summary;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 3. Render Implications Chips</p>
<p class="p1"><span class="Apple-converted-space">                </span>implicationsChipGroup.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>['G', 'F', 'C', 'S', 'I'].forEach(fund =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const tilt = analysis.implications[fund];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const chip = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>chip.className = `tilt-chip ${tilt}`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>chip.innerHTML = `&lt;span class="tilt-chip-label"&gt;${fund}&lt;/span&gt; ${tilt}`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>implicationsChipGroup.appendChild(chip);</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>function renderHeadlineFeed(headlines, mode) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>headlineListContainer.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (headlines.length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>headlineListContainer.innerHTML = '&lt;p&gt;No headlines match your filters.&lt;/p&gt;';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>headlines.forEach(h =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const item = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>item.className = 'headline-item';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>item.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="headline-header"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;h5&gt;${h.text}&lt;/h5&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;span class="expand-chevron" data-headline-id="${h.id}"&gt;+&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="headline-meta"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;span class="sentiment ${h.sentiment.toLowerCase()}"&gt;${h.sentiment}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;span class="topic-chip ${h.topic.toLowerCase()}"&gt;${h.topic}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="headline-explanation ${mode === 'Detailed' ? '' : 'hidden'}" id="explanation-${h.id}"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>${h.explanation}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>headlineListContainer.appendChild(item);</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Add click listeners to chevrons</p>
<p class="p1"><span class="Apple-converted-space">                </span>headlineListContainer.querySelectorAll('.expand-chevron').forEach(chevron =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>chevron.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const id = chevron.dataset.headlineId;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const explanation = $(`explanation-${id}`);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const isExpanded = !explanation.classList.contains('hidden');</p>
<p class="p2"><span class="Apple-converted-space">                        </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>explanation.classList.toggle('hidden', isExpanded);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>chevron.classList.toggle('expanded', !isExpanded);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>chevron.textContent = isExpanded ? '+' : '−';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>function exportBrief() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>let text = "=== Today's TSP Brief ===\n\n";</p>
<p class="p1"><span class="Apple-converted-space">                </span>text += "--- Today's Brief ---\n";</p>
<p class="p1"><span class="Apple-converted-space">                </span>briefList.querySelectorAll('li').forEach(li =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>text += `* ${li.textContent}\n`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>text += "\n--- TSP Implications ---\n";</p>
<p class="p1"><span class="Apple-converted-space">                </span>text += implicationsSummary.textContent;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>text += "\n\n--- Suggested Tilts ---\n";</p>
<p class="p1"><span class="Apple-converted-space">                </span>implicationsChipGroup.querySelectorAll('.tilt-chip').forEach(chip =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>text += `${chip.textContent.replace(/\s+/g, ' ')}\n`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>text += "\n\nDisclaimer: This tool is for educational purposes only. Headlines are illustrative. No financial advice is provided or implied.";</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const blob = new Blob([text], { type: 'text/plain' });</p>
<p class="p1"><span class="Apple-converted-space">                </span>const href = URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const a = document.createElement('a');</p>
<p class="p1"><span class="Apple-converted-space">                </span>a.href = href;</p>
<p class="p1"><span class="Apple-converted-space">                </span>a.download = 'TSP_Brief.txt';</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.body.appendChild(a);</p>
<p class="p1"><span class="Apple-converted-space">                </span>a.click();</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.body.removeChild(a);</p>
<p class="p1"><span class="Apple-converted-space">                </span>URL.revokeObjectURL(href);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- End of Insights Logic ---</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// ======================================================</p>
<p class="p1"><span class="Apple-converted-space">            </span>// TAB 3: RETIREMENT WITHDRAWAL RESILIENCE</p>
<p class="p1"><span class="Apple-converted-space">            </span>// ======================================================</p>
<p class="p1"><span class="Apple-converted-space">            </span>const runSimulationBtn = $('run-simulation');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const runSimulationText = $('run-simulation-text');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const allocationSliders = document.querySelectorAll('.allocation-slider');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const totalAllocationSpan = $('total-allocation');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const allocationWarning = $('allocation-warning');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const resilienceResultsContainer = $('resilience-results');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const loader = $('simulation-loader');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const resilienceModeRadios = document.querySelectorAll('input[name="resilience-mode"]');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const downloadSummaryBtn = $('download-summary-btn');</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const modeAInputs = $('mode-a-inputs');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const modeBInputs = $('mode-b-inputs');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const modeAResults = document.querySelectorAll('.mode-a-result');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const modeBResults = document.querySelectorAll('.mode-b-result');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Slider logic ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>function updateAllocationTotal() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>let total = 0;</p>
<p class="p1"><span class="Apple-converted-space">                </span>allocationSliders.forEach(slider =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const valueSpan = $(`${slider.id.replace('-slider', '-value')}`);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const value = parseInt(slider.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (valueSpan) valueSpan.textContent = value;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>total += value;</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>totalAllocationSpan.textContent = total;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const isValid = total === 100;</p>
<p class="p1"><span class="Apple-converted-space">                </span>totalAllocationSpan.style.color = isValid ? 'var(--success)' : 'var(--danger)';</p>
<p class="p1"><span class="Apple-converted-space">                </span>allocationWarning.classList.toggle('hidden', isValid);</p>
<p class="p1"><span class="Apple-converted-space">                </span>runSimulationBtn.disabled = !isValid;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>allocationSliders.forEach(slider =&gt; slider.addEventListener('input', updateAllocationTotal));</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Mode Toggle Logic ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>function toggleResilienceMode() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const mode = document.querySelector('input[name="resilience-mode"]:checked').value;</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (mode === 'A') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>modeAInputs.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>modeBInputs.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>modeAResults.forEach(el =&gt; el.classList.remove('hidden'));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>modeBResults.forEach(el =&gt; el.classList.add('hidden'));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>runSimulationText.textContent = 'Run Simulation';</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>modeAInputs.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>modeBInputs.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>modeAResults.forEach(el =&gt; el.classList.add('hidden'));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>modeBResults.forEach(el =&gt; el.classList.remove('hidden'));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>runSimulationText.textContent = 'Calculate Required Amount';</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>resilienceResultsContainer.classList.add('hidden'); // Hide old results on toggle</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>resilienceModeRadios.forEach(radio =&gt; radio.addEventListener('change', toggleResilienceMode));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Copy from Optimizer Logic ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>function updateResilienceSliders(allocation) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!allocation) return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>$('g-fund-slider').value = allocation.G;</p>
<p class="p1"><span class="Apple-converted-space">                </span>$('f-fund-slider').value = allocation.F;</p>
<p class="p1"><span class="Apple-converted-space">                </span>$('c-fund-slider').value = allocation.C;</p>
<p class="p1"><span class="Apple-converted-space">                </span>$('s-fund-slider').value = allocation.S;</p>
<p class="p1"><span class="Apple-converted-space">                </span>$('i-fund-slider').value = allocation.I;</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateAllocationTotal(); // Update values and 100% total</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Button click ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (runSimulationBtn) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>runSimulationBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Show loader, hide old results</p>
<p class="p1"><span class="Apple-converted-space">                    </span>loader.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>resilienceResultsContainer.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>downloadSummaryBtn.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>runSimulationBtn.disabled = true;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Use setTimeout to allow UI to update (show loader) before blocking</p>
<p class="p1"><span class="Apple-converted-space">                    </span>setTimeout(runResilienceSimulation, 50);</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (downloadSummaryBtn) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>downloadSummaryBtn.addEventListener('click', downloadSummary);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>function collectInputs() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const mode = document.querySelector('input[name="resilience-mode"]:checked').value;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const params = {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>mode: mode,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>horizon: parseInt($('retirement-horizon').value),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>inflation: parseFloat($('inflation-rate').value) / 100,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>targetProbability: parseFloat($('success-probability').value) / 100,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>numSims: parseInt($('num-simulations').value),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>allocations: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>G: parseFloat($('g-fund-slider').value) / 100,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>F: parseFloat($('f-fund-slider').value) / 100,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>C: parseFloat($('c-fund-slider').value) / 100,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>S: parseFloat($('s-fund-slider').value) / 100,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>I: parseFloat($('i-fund-slider').value) / 100,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>},</p>
<p class="p1"><span class="Apple-converted-space">                    </span>shocks: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>equityDrop: parseFloat($('equity-drop').value),</p>
<p class="p1"><span class="Apple-converted-space">                        </span>rateRise: parseFloat($('rate-rise').value),</p>
<p class="p1"><span class="Apple-converted-space">                        </span>inflationShock: parseFloat($('inflation-shock').value),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (mode === 'A') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>params.initialValue = parseFloat($('portfolio-value').value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>params.desiredMonthlyWithdrawal = parseFloat($('desired-monthly-withdrawal').value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>params.desiredAnnualWithdrawal = params.desiredMonthlyWithdrawal * 12;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>return params;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>function runResilienceSimulation() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const params = collectInputs();</p>
<p class="p1"><span class="Apple-converted-space">                </span>let results;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (params.mode === 'A') {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>results = solveForWithdrawalRate(params);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>results = solveForPortfolioValue(params);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>lastSimulationParams = params; // Save inputs</p>
<p class="p1"><span class="Apple-converted-space">                    </span>lastSimulationResults = results; // Save results</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>displayResilienceResults(results, params);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>downloadSummaryBtn.classList.remove('hidden');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error("Simulation failed:", error);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>$('resilience-summary').innerHTML = `&lt;span style="color: var(--danger);"&gt;An error occurred: ${error.message}&lt;/span&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Hide loader, show results</p>
<p class="p1"><span class="Apple-converted-space">                </span>loader.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>resilienceResultsContainer.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>runSimulationBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>function displayResilienceResults(results, params) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const { mode } = params;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (results.error) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>$('resilience-summary').innerHTML = `&lt;span style="color: var(--danger);"&gt;${results.error}&lt;/span&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>$('simulation-count-display').textContent = `Simulations: ${params.numSims.toLocaleString()}`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Shared metrics</p>
<p class="p1"><span class="Apple-converted-space">                </span>$('success-prob-result').textContent = `${(results.successProbability * 100).toFixed(1)}%`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>$('depletion-year-result').textContent = results.depletion10th ? `Year ${results.depletion10th}` : "N/A (Success)";</p>
<p class="p1"><span class="Apple-converted-space">                </span>$('simulation-count-display').textContent = `Simulations: ${results.numSims.toLocaleString()}`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Mode-specific metrics and summary</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (mode === 'A') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const annualWithdrawal = results.sustainableWithdrawal;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const monthlyWithdrawal = annualWithdrawal / 12;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>$('annual-withdrawal-result').textContent = formatter.format(annualWithdrawal);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>$('monthly-withdrawal-result').textContent = formatter.format(monthlyWithdrawal);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>const shockText = params.shocks.equityDrop &lt; 0 ? ` even with a ${(params.shocks.equityDrop * 100)}% market drop` : "";</p>
<p class="p1"><span class="Apple-converted-space">                    </span>$('resilience-summary').innerHTML =<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>`Based on ${params.numSims.toLocaleString()} simulations, a monthly withdrawal of &lt;strong&gt;${formatter.format(monthlyWithdrawal)}&lt;/strong&gt;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>(growing with inflation) gives a &lt;strong&gt;${(results.successProbability * 100).toFixed(1)}%&lt;/strong&gt; chance<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>of your &lt;strong&gt;${formatter.format(params.initialValue)}&lt;/strong&gt; portfolio lasting &lt;strong&gt;${params.horizon}&lt;/strong&gt; years${shockText}.`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else { // Mode B</p>
<p class="p1"><span class="Apple-converted-space">                    </span>$('required-portfolio-result').textContent = intFormatter.format(results.requiredPortfolio);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>const shockText = params.shocks.equityDrop &lt; 0 ? ` (with a ${(params.shocks.equityDrop * 100)}% shock)` : "";</p>
<p class="p1"><span class="Apple-converted-space">                    </span>$('resilience-summary').innerHTML =<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>`To withdraw &lt;strong&gt;${formatter.format(params.desiredMonthlyWithdrawal)}/month&lt;/strong&gt; (growing with inflation)<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>for &lt;strong&gt;${params.horizon}&lt;/strong&gt; years with a &lt;strong&gt;${(results.successProbability * 100).toFixed(1)}%&lt;/strong&gt; success rate${shockText},<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>you would need a starting portfolio of about &lt;strong&gt;${intFormatter.format(results.requiredPortfolio)}&lt;/strong&gt;.`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Draw Chart</p>
<p class="p1"><span class="Apple-converted-space">                </span>displayResilienceChart(results.percentiles, params.horizon);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>function displayResilienceChart(percentiles, horizon) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const ctx = $('resilience-line-chart').getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const labels = Array.from({ length: horizon + 1 }, (_, i) =&gt; `${i}`);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (resilienceChart) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>resilienceChart.destroy();</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>resilienceChart = new Chart(ctx, {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>type: 'line',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>data: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>labels: labels,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>datasets: [</p>
<p class="p1"><span class="Apple-converted-space">                            </span>{</p>
<p class="p1"><span class="Apple-converted-space">                                </span>label: '10th Percentile (Poor Outcome)',</p>
<p class="p1"><span class="Apple-converted-space">                                </span>data: percentiles.p10,</p>
<p class="p1"><span class="Apple-converted-space">                                </span>borderColor: 'rgba(153, 0, 0, 0.6)',</p>
<p class="p1"><span class="Apple-converted-space">                                </span>backgroundColor: 'rgba(153, 0, 0, 0.1)',</p>
<p class="p1"><span class="Apple-converted-space">                                </span>fill: false,</p>
<p class="p1"><span class="Apple-converted-space">                                </span>tension: 0.1,</p>
<p class="p1"><span class="Apple-converted-space">                                </span>pointRadius: 0</p>
<p class="p1"><span class="Apple-converted-space">                            </span>},</p>
<p class="p1"><span class="Apple-converted-space">                            </span>{</p>
<p class="p1"><span class="Apple-converted-space">                                </span>label: '50th Percentile (Median)',</p>
<p class="p1"><span class="Apple-converted-space">                                </span>data: percentiles.p50,</p>
<p class="p1"><span class="Apple-converted-space">                                </span>borderColor: 'var(--navy)',</p>
<p class="p1"><span class="Apple-converted-space">                                </span>backgroundColor: 'rgba(0, 51, 102, 0.1)',</p>
<p class="p1"><span class="Apple-converted-space">                                </span>fill: false,</p>
<p class="p1"><span class="Apple-converted-space">                                </span>borderWidth: 3,</p>
<p class="p1"><span class="Apple-converted-space">                                </span>tension: 0.1,</p>
<p class="p1"><span class="Apple-converted-space">                                </span>pointRadius: 0</p>
<p class="p1"><span class="Apple-converted-space">                            </span>},</p>
<p class="p1"><span class="Apple-converted-space">                            </span>{</p>
<p class="p1"><span class="Apple-converted-space">                                </span>label: '90th Percentile (Good Outcome)',</p>
<p class="p1"><span class="Apple-converted-space">                                </span>data: percentiles.p90,</p>
<p class="p1"><span class="Apple-converted-space">                                </span>borderColor: 'rgba(0, 100, 0, 0.6)',</p>
<p class="p1"><span class="Apple-converted-space">                                </span>backgroundColor: 'rgba(0, 100, 0, 0.1)',</p>
<p class="p1"><span class="Apple-converted-space">                                </span>fill: false,</p>
<p class="p1"><span class="Apple-converted-space">                                </span>tension: 0.1,</p>
<p class="p1"><span class="Apple-converted-space">                                </span>pointRadius: 0</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>]</p>
<p class="p1"><span class="Apple-converted-space">                    </span>},</p>
<p class="p1"><span class="Apple-converted-space">                    </span>options: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>responsive: true,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>maintainAspectRatio: false,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>scales: {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>y: {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>ticks: {</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>callback: function(value) {</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>return '$' + (value / 1000) + 'k';</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>},</p>
<p class="p1"><span class="Apple-converted-space">                                </span>title: {</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>display: true,</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>text: 'Portfolio Value'</p>
<p class="p1"><span class="Apple-converted-space">                                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                            </span>},</p>
<p class="p1"><span class="Apple-converted-space">                            </span>x: {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>title: {</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>display: true,</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>text: 'Year of Retirement'</p>
<p class="p1"><span class="Apple-converted-space">                                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>},</p>
<p class="p1"><span class="Apple-converted-space">                        </span>plugins: {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>tooltip: {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>mode: 'index',</p>
<p class="p1"><span class="Apple-converted-space">                                </span>intersect: false,</p>
<p class="p1"><span class="Apple-converted-space">                                </span>callbacks: {</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>label: function(context) {</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>let label = context.dataset.label || '';</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>if (label) { label += ': '; }</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>if (context.parsed.y !== null) {</p>
<p class="p1"><span class="Apple-converted-space">                                            </span>label += formatter.format(context.parsed.y);</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>return label;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>function downloadSummary() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!lastSimulationParams || !lastSimulationResults) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>alert('Please run a simulation before downloading.');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const summary = {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>reportDate: new Date().toISOString(),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>inputs: lastSimulationParams,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>outputs: lastSimulationResults</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(summary, null, 2));</p>
<p class="p1"><span class="Apple-converted-space">                </span>const downloadAnchorNode = document.createElement('a');</p>
<p class="p1"><span class="Apple-converted-space">                </span>downloadAnchorNode.setAttribute("href", dataStr);</p>
<p class="p1"><span class="Apple-converted-space">                </span>downloadAnchorNode.setAttribute("download", "tsp_resilience_summary.json");</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.body.appendChild(downloadAnchorNode); // required for firefox</p>
<p class="p1"><span class="Apple-converted-space">                </span>downloadAnchorNode.click();</p>
<p class="p1"><span class="Apple-converted-space">                </span>downloadAnchorNode.remove();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// ======================================================</p>
<p class="p1"><span class="Apple-converted-space">            </span>// MONTE CARLO SIMULATION ENGINE</p>
<p class="p1"><span class="Apple-converted-space">            </span>// ======================================================</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const FUND_PARAMS = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// format: { mean, stdDev }</p>
<p class="p1"><span class="Apple-converted-space">                </span>G: { mean: 0.025, stdDev: 0.005 },</p>
<p class="p1"><span class="Apple-converted-space">                </span>F: { mean: 0.035, stdDev: 0.050 },</p>
<p class="p1"><span class="Apple-converted-space">                </span>C: { mean: 0.070, stdDev: 0.160 },</p>
<p class="p1"><span class="Apple-converted-space">                </span>S: { mean: 0.075, stdDev: 0.200 },</p>
<p class="p1"><span class="Apple-converted-space">                </span>I: { mean: 0.065, stdDev: 0.170 }</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Pre-generate standard normal random numbers for performance</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Uses Box-Muller transform</p>
<p class="p1"><span class="Apple-converted-space">            </span>function pregenerateStandardNormals(count) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const normals = new Float32Array(count);</p>
<p class="p1"><span class="Apple-converted-space">                </span>for (let i = 0; i &lt; count; i += 2) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>let u1 = 0, u2 = 0;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>while (u1 === 0) u1 = Math.random();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>while (u2 === 0) u2 = Math.random();</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>const z1 = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const z2 = Math.sqrt(-2.0 * Math.log(u1)) * Math.sin(2.0 * Math.PI * u2);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>normals[i] = z1;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (i + 1 &lt; count) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>normals[i + 1] = z2;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>return normals;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>/**</p>
<p class="p1"><span class="Apple-converted-space">             </span>* Runs a single simulation of portfolio depletion.</p>
<p class="p1"><span class="Apple-converted-space">             </span>* Reads from pre-generated random number arrays.</p>
<p class="p1"><span class="Apple-converted-space">             </span>*/</p>
<p class="p1"><span class="Apple-converted-space">            </span>function runSingleSimulation(params, annualWithdrawal, simIndex, randoms) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>let currentValue = params.initialValue;</p>
<p class="p1"><span class="Apple-converted-space">                </span>let currentWithdrawal = annualWithdrawal;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const balanceHistory = [currentValue];</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const simOffset = simIndex * params.horizon;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>for (let year = 1; year &lt;= params.horizon; year++) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const isYear1 = (year === 1);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const randIdx = simOffset + year - 1; // Index for this sim-year</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// --- 1. Calculate Portfolio Return ---</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const equityDrop = isYear1 ? params.shocks.equityDrop : 0;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const rateRise = isYear1 ? params.shocks.rateRise : 0;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Get return = (pregen_normal * stdDev) + mean</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const gReturn = (randoms.G[randIdx] * FUND_PARAMS.G.stdDev + FUND_PARAMS.G.mean) - (isYear1 ? rateRise * 0.5 : 0);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const fReturn = (randoms.F[randIdx] * FUND_PARAMS.F.stdDev + FUND_PARAMS.F.mean) - (isYear1 ? rateRise * 1.0 : 0);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const cReturn = (randoms.C[randIdx] * FUND_PARAMS.C.stdDev + FUND_PARAMS.C.mean) + equityDrop;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const sReturn = (randoms.S[randIdx] * FUND_PARAMS.S.stdDev + FUND_PARAMS.S.mean) + equityDrop;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const iReturn = (randoms.I[randIdx] * FUND_PARAMS.I.stdDev + FUND_PARAMS.I.mean) + equityDrop;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>const totalReturn =</p>
<p class="p1"><span class="Apple-converted-space">                        </span>(gReturn * params.allocations.G) +</p>
<p class="p1"><span class="Apple-converted-space">                        </span>(fReturn * params.allocations.F) +</p>
<p class="p1"><span class="Apple-converted-space">                        </span>(cReturn * params.allocations.C) +</p>
<p class="p1"><span class="Apple-converted-space">                        </span>(sReturn * params.allocations.S) +</p>
<p class="p1"><span class="Apple-converted-space">                        </span>(iReturn * params.allocations.I);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// --- 2. Apply Return ---</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentValue *= (1 + totalReturn);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// --- 3. Make Withdrawal (at end of year) ---</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentValue -= currentWithdrawal;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// --- 4. Check for Depletion ---</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (currentValue &lt;= 0) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>balanceHistory.push(0);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>return { success: false, depletionYear: year, history: balanceHistory };</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// --- 5. Inflate Withdrawal for Next Year ---</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const inflationShock = isYear1 ? params.shocks.inflationShock : 0;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentWithdrawal *= (1 + params.inflation + inflationShock);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>balanceHistory.push(currentValue);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>return { success: true, depletionYear: null, history: balanceHistory };</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>/**</p>
<p class="p1"><span class="Apple-converted-space">             </span>* Runs the full Monte Carlo simulation 'n' times.</p>
<p class="p1"><span class="Apple-converted-space">             </span>*/</p>
<p class="p1"><span class="Apple-converted-space">            </span>function runMonteCarlo(params, annualWithdrawal) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>let successCount = 0;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const allHistories = [];</p>
<p class="p1"><span class="Apple-converted-space">                </span>const depletionYears = [];</p>
<p class="p1"><span class="Apple-converted-space">                </span>const numSims = params.numSims;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const numValues = numSims * params.horizon;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 1. Pre-generate all random numbers for performance</p>
<p class="p1"><span class="Apple-converted-space">                </span>const randoms = {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>G: pregenerateStandardNormals(numValues),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>F: pregenerateStandardNormals(numValues),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>C: pregenerateStandardNormals(numValues),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>S: pregenerateStandardNormals(numValues),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>I: pregenerateStandardNormals(numValues)</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 2. Run simulations</p>
<p class="p1"><span class="Apple-converted-space">                </span>for (let i = 0; i &lt; numSims; i++) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const result = runSingleSimulation(params, annualWithdrawal, i, randoms);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (result.success) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>successCount++;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>depletionYears.push(result.depletionYear);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Pad history if it failed early, to make percentile calculation easier</p>
<p class="p1"><span class="Apple-converted-space">                    </span>while (result.history.length &lt;= params.horizon) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>result.history.push(0);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>allHistories.push(result.history);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const successProbability = successCount / numSims;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 3. Calculate percentiles for the chart</p>
<p class="p1"><span class="Apple-converted-space">                </span>const percentiles = { p10: [], p50: [], p90: [] };</p>
<p class="p1"><span class="Apple-converted-space">                </span>for (let year = 0; year &lt;= params.horizon; year++) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const yearValues = allHistories.map(history =&gt; history[year]).sort((a, b) =&gt; a - b);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>percentiles.p10.push(yearValues[Math.floor(numSims * 0.10)]);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>percentiles.p50.push(yearValues[Math.floor(numSims * 0.50)]);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>percentiles.p90.push(yearValues[Math.floor(numSims * 0.90)]);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 4. Calculate 10th percentile depletion year</p>
<p class="p1"><span class="Apple-converted-space">                </span>let depletion10th = null;</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (depletionYears.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>depletionYears.sort((a, b) =&gt; a - b);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>depletion10th = depletionYears[Math.floor(depletionYears.length * 0.10)] || depletionYears[0];</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>return { numSims, successProbability, percentiles, depletion10th };</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>/**</p>
<p class="p1"><span class="Apple-converted-space">             </span>* Solves for the sustainable withdrawal amount using binary search.</p>
<p class="p1"><span class="Apple-converted-space">             </span>*/</p>
<p class="p1"><span class="Apple-converted-space">            </span>function solveForWithdrawalRate(params) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>let minWithdrawal = 0;</p>
<p class="p1"><span class="Apple-converted-space">                </span>let maxWithdrawal = params.initialValue * 0.15; // 15% SWR is a high upper bound</p>
<p class="p1"><span class="Apple-converted-space">                </span>let bestWithdrawal = 0;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const iterations = 15; // Binary search iterations</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>for (let i = 0; i &lt; iterations; i++) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const testWithdrawal = (minWithdrawal + maxWithdrawal) / 2;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const results = runMonteCarlo(params, testWithdrawal);</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (results.successProbability &gt;= params.targetProbability) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>bestWithdrawal = testWithdrawal;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>minWithdrawal = testWithdrawal;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>maxWithdrawal = testWithdrawal;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const finalResults = runMonteCarlo(params, bestWithdrawal);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>sustainableWithdrawal: bestWithdrawal,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>...finalResults</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>/**</p>
<p class="p1"><span class="Apple-converted-space">             </span>* Solves for the required portfolio value using binary search.</p>
<p class="p1"><span class="Apple-converted-space">             </span>*/</p>
<p class="p1"><span class="Apple-converted-space">            </span>function solveForPortfolioValue(params) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>let minPortfolio = 10000; // $10k</p>
<p class="p1"><span class="Apple-converted-space">                </span>let maxPortfolio = 10000000; // $10M</p>
<p class="p1"><span class="Apple-converted-space">                </span>let bestPortfolio = maxPortfolio;</p>
<p class="p1"><span class="Apple-converted-space">                </span>let lastSuccessProb = 0;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const iterations = 16; // Binary search iterations</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>for (let i = 0; i &lt; iterations; i++) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const testPortfolio = (minPortfolio + maxPortfolio) / 2;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const localParams = { ...params, initialValue: testPortfolio };</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const results = runMonteCarlo(localParams, params.desiredAnnualWithdrawal);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>lastSuccessProb = results.successProbability;</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (lastSuccessProb &gt;= params.targetProbability) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>bestPortfolio = testPortfolio; // This works, try lower</p>
<p class="p1"><span class="Apple-converted-space">                        </span>maxPortfolio = testPortfolio;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>minPortfolio = testPortfolio; // This failed, must try higher</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Check if we ever succeeded</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (bestPortfolio === 10000000 &amp;&amp; lastSuccessProb &lt; params.targetProbability) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>// Even at $10M, we failed. Try one last time at $20M</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const finalTestParams = { ...params, initialValue: 20000000 };</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const finalTestResults = runMonteCarlo(finalTestParams, params.desiredAnnualWithdrawal);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (finalTestResults.successProbability &lt; params.targetProbability) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>return {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>error: `The target may be too aggressive. Even a $20M portfolio had a ${ (finalTestResults.successProbability * 100).toFixed(1) }% success rate. Try a lower withdrawal or different settings.`,</p>
<p class="p1"><span class="Apple-converted-space">                            </span>...finalTestResults<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>};</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>bestPortfolio = 20000000;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Run one final simulation with the "best" value to get final chart data</p>
<p class="p1"><span class="Apple-converted-space">                </span>const finalParams = { ...params, initialValue: bestPortfolio };</p>
<p class="p1"><span class="Apple-converted-space">                </span>const finalResults = runMonteCarlo(finalParams, params.desiredAnnualWithdrawal);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>return {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>requiredPortfolio: bestPortfolio,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>...finalResults</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// --- Initializer calls ---</p>
<p class="p1"><span class="Apple-converted-space">            </span>initializeInsightsTab(); // Initialize the new insights tab</p>
<p class="p1"><span class="Apple-converted-space">            </span>updateAllocationTotal(); // Initial call for resilience tab sliders</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
<p class="p2"><br></p>
</body>
</html>
